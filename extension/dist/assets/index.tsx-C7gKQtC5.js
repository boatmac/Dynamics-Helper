import{r as c,j as r,c as p}from"./index-C1aTXuGP.js";function f(s){if(!s)return null;const e=Object.keys(s),n=e.find(t=>t.startsWith("__reactFiber$")),o=e.find(t=>t.startsWith("__reactProps$"));if(o)return s[o];if(n&&s[n]){const t=s[n];if(t.memoizedProps)return t.memoizedProps}return null}class l{static scanForErrors(){const e=document.querySelector('[data-automation-id="error-message"]');if(e){const t=f(e);return t&&t.children?{errorText:this.extractTextFromChildren(t.children),source:"fluent-automation-id"}:{errorText:e.textContent||"",source:"dom-text"}}const n=document.querySelectorAll('[role="alert"]');for(const t of Array.from(n))if(t.textContent&&t.textContent.toLowerCase().includes("error"))return{errorText:t.textContent,source:"aria-role-alert"};const o=window.getSelection();return o&&o.toString().length>5?{errorText:o.toString(),source:"user-selection"}:null}static extractTextFromChildren(e){return e?typeof e=="string"?e:typeof e=="number"?String(e):Array.isArray(e)?e.map(n=>this.extractTextFromChildren(n)).join(" "):typeof e=="object"&&e.props&&e.props.children?this.extractTextFromChildren(e.props.children):"":""}}const h=()=>{const[s,e]=c.useState(!1),[n,o]=c.useState(""),[t,i]=c.useState(null);c.useEffect(()=>{if(s){const a=l.scanForErrors();i(a)}},[s]);const u=async()=>{try{const a=await chrome.runtime.sendMessage({type:"NATIVE_MSG",payload:{action:"ping",requestId:crypto.randomUUID()}});o(JSON.stringify(a,null,2))}catch(a){o(`Error: ${a.message}`)}},m=async()=>{if(t?.errorText){o("Analyzing...");try{const a=await chrome.runtime.sendMessage({type:"NATIVE_MSG",payload:{action:"analyze_error",payload:{text:t.errorText,context:t.source||"Unknown Context"},requestId:crypto.randomUUID()}});o(JSON.stringify(a,null,2))}catch(a){o(`Error: ${a.message}`)}}};return r.jsxs("div",{className:"fixed bottom-6 right-6 z-[9999] font-sans",children:[s&&r.jsxs("div",{className:"mb-4 w-80 bg-white rounded-lg shadow-xl border border-gray-200 p-4 flex flex-col gap-3",children:[r.jsx("div",{className:"flex justify-between items-center border-b pb-2",children:r.jsx("h3",{className:"font-bold text-gray-800",children:"Dynamics Helper"})}),r.jsxs("div",{className:"bg-blue-50 p-2 rounded border border-blue-100",children:[r.jsx("h4",{className:"text-xs font-semibold text-blue-800 uppercase mb-1",children:"Detected Error"}),t?r.jsx("p",{className:"text-xs text-gray-700 line-clamp-3 font-mono",children:t.errorText}):r.jsx("p",{className:"text-xs text-gray-500 italic",children:"No error selected or detected."}),r.jsx("div",{className:"mt-2 flex justify-end",children:r.jsx("button",{onClick:()=>{const a=l.scanForErrors();i(a)},className:"text-xs text-blue-600 hover:underline",children:"Re-scan"})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:u,className:"flex-1 px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm transition-colors",children:"Ping Host"}),r.jsx("button",{onClick:m,disabled:!t,className:`flex-1 px-3 py-1 rounded text-white text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}`,children:"Analyze Error"})]}),n&&r.jsxs("div",{className:"mt-2",children:[r.jsx("h4",{className:"text-xs font-semibold text-gray-500 mb-1",children:"Host Response:"}),r.jsx("pre",{className:"text-xs bg-gray-900 text-green-400 p-2 rounded overflow-auto max-h-48 whitespace-pre-wrap",children:n})]})]}),r.jsx("button",{onClick:()=>e(!s),className:"w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg flex items-center justify-center transition-all hover:scale-105 active:scale-95",children:s?r.jsx("span",{className:"text-xl font-bold",children:"Ã—"}):r.jsx("span",{className:"text-xl font-bold",children:"DH"})})]})};console.log("[DH] Content Script Loaded");const d="dh-extension-root";function x(){if(document.getElementById(d))return;const s=document.createElement("div");s.id=d,document.body.appendChild(s);const e=s.attachShadow({mode:"open"}),n=document.createElement("style");e.appendChild(n),p.createRoot(e).render(r.jsx(h,{}))}document.body?x():document.addEventListener("DOMContentLoaded",x);
